<!DOCTYPE html>
<html>
   <head>
      <meta charset="utf-8" />
      <title>Learn Countries</title>
      <link rel="stylesheet" type="text/css" href="style.css">
   </head>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
<body>
<div>Bienvenue à la partie exercice</div>
<a href="cours.html">Cours</a>
<nav>
   <ul>
      <li id="Quizz">Quizz</li>
      <li id="QCM">QCM</li>
      <li id="Ordonnancement">Ordonnancement</li>
   </ul>
</nav>

<!-- QUIZZ -->
<section id="sectionQuizz">
   Question :<br>
   <span id="questionQuizz"></span><br>
   <input type="text" id="reponse"/>
</section>

<!-- QCM -->
<section id="sectionQCM">
   Section QCM<br>
   Question :<br>
   <span id="questionQCM"></span><br>
   <fieldset>
   <input type="radio" name="rep"/><span id="reponse1"></span><br>
   <input type="radio" name="rep"/><span id="reponse2"></span><br>
   <input type="radio" name="rep"/><span id="reponse3"></span><br>
   </fieldset>
</section>

<!-- ORDONNANCEMENT -->
<section id="sectionOrder">
   Section order
</section>

<button id="corriger">Corriger</button>
<span id="result">plop</span><br>
<button id="next">Next</button>

<script>
   var type = "Quizz";
   var reponse = "";

   //Contient les questions et les requetes sparql associées
   var questionsQuizz = new Array();




   //Langue
   questionsQuizz[0] = new Array();
   questionsQuizz[0]["question"] = "En <param>, quelle est la langue ?";
   questionsQuizz[0]["sparql"] = "select ?pays ?langage where {" +
                                    "service <http://dbpedia.org/sparql>{"+
                                       "?pays a <http://dbpedia.org/ontology/Country>."+
                                       "?pays dbpedia-owl:language ?p."+
                                       "?p rdfs:label ?langage."+
                                       "FILTER(langMatches(lang(?langage), 'en') || langMatches(lang(?langage), 'fr'))"+
                                 "}}"+
                                 "ORDER BY ?pays OFFSET <randomNb> LIMIT 1";

   //Capitale
   questionsQuizz[1] = new Array();
   questionsQuizz[1]["question"] = "En <param>, quelle est la capitale ?";
   questionsQuizz[1]["sparql"] = "select ?pays ?capitale where {"+
                                    "service <http://dbpedia.org/sparql>{"+
                                       "?pays a <http://dbpedia.org/ontology/Country>."+
                                       "?pays dbpprop:capital ?p."+
                                       "?p dbpprop:name ?capitale."+
                                       "FILTER(langMatches(lang(?capitale), 'en') )"+
                                 "}}"+
                                 "ORDER BY ?pays OFFSET <randomNb> LIMIT 1";

   //president
   questionsQuizz[2] = new Array();
   questionsQuizz[2]["question"] = "En <param>, qui est le président ?";
   questionsQuizz[2]["sparql"] = "select ?pays ?presidentName where {"+
                                    "service <http://dbpedia.org/sparql>{"+
                                       "?pays a <http://dbpedia.org/ontology/Country>."+
                                       "?pays dbpedia-owl:leader ?p."+
                                       "?p dbpprop:name ?presidentName."+
                                       "FILTER(langMatches(lang(?presidentName), 'en'))"+
                                 "}}"+
                                 "ORDER BY ?pays OFFSET <randomNb> LIMIT 1";

   //surface
   questionsQuizz[3] = new Array();
   questionsQuizz[3]["question"] = "Quelle est la surface de <param> ? (en km2)";
   questionsQuizz[3]["sparql"] = "select ?pays ?surface where {"+
                                    "service <http://dbpedia.org/sparql>{"+
                                       "?pays a <http://dbpedia.org/ontology/Country>."+
                                       "?pays dbpprop:areaKm ?surface."+
                                 "}}"+
                                 "ORDER BY ?pays OFFSET <randomNb> LIMIT 1";


   $('#Quizz').click(function() {
      $('#sectionQuizz').show();
      $('#sectionQCM').hide();
      $('#sectionOrder').hide();
      type = "Quizz"
      eraseQuestion()
      generateQuestion()
   });
   $('#next').click(function() {
      eraseQuestion()
      if (type == "Quizz") {      
         eraseQuestion()
         generateQuestion()
      } else if (type == "QCM") {
         generateQCM()
      }
      reponse = "yo"
   });
   $('#corriger').click(function() {
      var rep = ""
      if (type == "Quizz") {
         rep = $('#reponse').val()
      } else if (type == "QCM") {
         rep = $('input[name*="rep"]:checked').next().text()
      }
      corriger(rep)
   });
   corriger = function(answerGiven) {
      if (answerGiven == reponse) {
         $('#result').text("Correct")
      } else {
         $('#result').text("La bonne réponse était : " + reponse)
      }
   }
   generateQCM = function() {
      //Chercher une question et 3 réponses
      //Mettre la bonne réponse dans reponse
      /*reponse = ""
      $('#reponse1').text("rep1")
      $('#reponse2').text("rep2")
      $('#reponse3').text("rep3")*/
      generateQuestion()
   }
   //Génère une questionaléatoire a propos d'un pays choisi aléatoirement
   generateQuestion = function() {

      //Choose a random question from the question array
      var randomQuestion = 3 //Math.floor((Math.random() * questionsQuizz.length)); //genere un nombre aleatoire entre 0 et le nombre de questions dans le tableau questionsQuizz

      var tab;
      var randomNb = Math.floor((Math.random() * 300) + 1);
      var req = questionsQuizz[randomQuestion]["sparql"].replace("<randomNb>", randomNb);
      givenQuery = escape(req);
      givenQuery = "http://localhost:8080/sparql/template?query=" + givenQuery  + " .s0, .s1";
      console.log("query");
      $( "#pays" ).load(givenQuery, function(data){
         console.log("load");
         $('tr').each(function() {
               var row = $(this);
               console.log('treatment ' + row.html());
               var i = 0;
               var pays = "";
               var res = "";
               row.children('td').each(function() {
                  if($(this).html() != "" && $(this).html().indexOf("http://dbpedia.org/") == -1 ){
                     res = $(this).html();
                     console.log(res);
                     res = res.replace(/"/g, '').replace("@en", "").replace("@fr", "").replace(" language", "");
                  }else{
                     pays = $(this).html();
                     console.log(pays);
                     pays = pays.replace("http://dbpedia.org/resource/", "").replace(/_/g," ");
                  }
                  i++;
               });
               //La mettre dans $('#question').text(question)
               var question = questionsQuizz[randomQuestion]["question"].replace("<param>", pays);
               $('#questionQuizz').text(question);
               //Obtenir la réponse
               reponse = res;
               if(type == "QCM") {
                  $('#questionQCM').text(question);
                  var nb = Math.floor((Math.random() * 3) + 1);
                  $('#reponse1').text("rep1")
                  $('#reponse2').text("rep2")
                  $('#reponse3').text("rep3")
                  $('#reponse'+nb).text(reponse);
               }
         });
      });
   }
   
   $('#QCM').click(function() {
      $('#sectionQuizz').hide();
      $('#sectionQCM').show();
      $('#sectionOrder').hide();
      type = "QCM"
      generateQCM()
   });
   
   $('#Ordonnancement').click(function() {
      $('#sectionQuizz').hide();
      $('#sectionQCM').hide();
      $('#sectionOrder').show();
   });
   
   eraseQuestion = function() {
      $('#reponse').val("")
      $('#result').text("")
      $('#question').text("")
      $('fieldset span').text("")
      $('#resultQCM').text("")
      $('#questionQCM').text("")
      $('#questionQuizz').text("")
   }
</script>
<div id="pays" style="display:none;"></div>
</body>
</html>
